"use strict";var e,t=require("tslib"),r=require("js-magic"),s=(e=require("axios"))&&"object"==typeof e&&"default"in e?e.default:e;function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var r,s,n={},o=Object.keys(e);for(s=0;s<o.length;s++)t.indexOf(r=o[s])>=0||(n[r]=e[r]);return n}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));class l{constructor(e,t){this.logger=e,this.httpRequestErrorService=t}process(e){this.logger&&this.logger.warn&&this.logger.warn("API ERROR",e);let t=e;"string"==typeof e&&(t=new Error(e)),this.httpRequestErrorService&&(void 0!==this.httpRequestErrorService.process?this.httpRequestErrorService.process(t):"function"==typeof this.httpRequestErrorService&&this.httpRequestErrorService(t))}}exports.HttpRequestHandler=class{constructor(e){let{baseURL:t="",timeout:r=null,cancellable:l=!1,strategy:a=null,flattenResponse:i=null,defaultResponse:u={},logger:c=null,onError:p=null}=e,h=o(e,["baseURL","timeout","cancellable","strategy","flattenResponse","defaultResponse","logger","onError"]);this.timeout=3e4,this.cancellable=!1,this.strategy="silent",this.flattenResponse=!0,this.defaultResponse=null,this.timeout=null!==r?r:this.timeout,this.strategy=null!==a?a:this.strategy,this.cancellable=l||this.cancellable,this.flattenResponse=null!==i?i:this.flattenResponse,this.defaultResponse=u,this.logger=c||global.console||window.console||null,this.httpRequestErrorService=p,this.requestsQueue=new Map,this.requestInstance=s.create(n({},h,{baseURL:t,timeout:this.timeout}))}getInstance(){return this.requestInstance}interceptRequest(e){this.getInstance().interceptors.request.use(e)}__get(e){return e in this?this[e]:this.prepareRequest.bind(this,e)}prepareRequest(e,t,r=null,s=null){return this.handleRequest({type:e,url:t,data:r,config:s})}buildRequestConfig(e,t,r,s){const o=e.toLowerCase();return n({},s,{url:t,method:o,["get"===o||"head"===o?"params":"data"]:r||{}})}processRequestError(e,t){s.isCancel(e)||(t.onError&&"function"==typeof t.onError&&t.onError(e),new l(this.logger,this.httpRequestErrorService).process(e))}outputErrorResponse(e,t){try{let n=!1;const o=this;function r(t){return n?t:"reject"===a||"throwError"===a?Promise.reject(e):o.defaultResponse}const l=t.cancelToken&&s.isCancel(e),a=t.strategy||o.strategy;if(l&&!t.rejectCancelled)return Promise.resolve(o.defaultResponse);const i=function(){if("silent"===a)return Promise.resolve(new Promise(()=>null)).then(function(){return n=!0,o.defaultResponse})}();return Promise.resolve(i&&i.then?i.then(r):r(i))}catch(e){return Promise.reject(e)}}isRequestCancelled(e,t){return t.cancelToken&&s.isCancel(e)}addCancellationToken(e,t,r){if(!this.cancellable&&!r.cancellable)return{};if(void 0!==r.cancellable&&!r.cancellable)return{};const n=`${e}-${t}`,o=this.requestsQueue.get(n);o&&o.cancel();const l=s.CancelToken.source();this.requestsQueue.set(n,l);const a=this.requestsQueue.get(n)||{};return a.token?{cancelToken:a.token}:{}}handleRequest({type:e,url:t,data:r=null,config:s=null}){try{let l=!1;const a=this;function o(e){return l?e:a.processResponseData(i)}let i=null,u=a.buildRequestConfig(e,t,r,s||{});u=n({},a.addCancellationToken(e,t,u),u);const c=function(e,t){try{var r=Promise.resolve(a.requestInstance.request(u)).then(function(e){i=e})}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}(0,function(e){a.processRequestError(e,u);const t=a.outputErrorResponse(e,u);return l=!0,t});return Promise.resolve(c&&c.then?c.then(o):o(c))}catch(e){return Promise.reject(e)}}processResponseData(e){return e.data?this.flattenResponse?"object"==typeof e.data&&void 0!==e.data.data&&1===Object.keys(e.data).length?e.data.data:e.data:e:this.defaultResponse}},exports.HttpRequestHandler=t.__decorate([r.applyMagic],exports.HttpRequestHandler),exports.ApiHandler=class{constructor(e){let{apiUrl:t,apiEndpoints:r,timeout:s=null,cancellable:l=!1,strategy:a=null,flattenResponse:i=null,defaultResponse:u={},logger:c=null,onError:p=null}=e,h=o(e,["apiUrl","apiEndpoints","timeout","cancellable","strategy","flattenResponse","defaultResponse","logger","onError"]);this.apiUrl="",this.apiUrl=t,this.apiEndpoints=r,this.logger=c,this.httpRequestHandler=new exports.HttpRequestHandler(n({},h,{baseURL:this.apiUrl,timeout:s,cancellable:l,strategy:a,flattenResponse:i,defaultResponse:u,logger:c,onError:p}))}getInstance(){return this.httpRequestHandler.getInstance()}__get(e){return e in this?this[e]:this.apiEndpoints[e]?this.handleRequest.bind(this,e):this.handleNonImplemented.bind(this,e)}handleRequest(...e){try{const t=this,r=t.apiEndpoints[e[0]],s=e[1]||{},o=e[2]||{},l=e[3]||{},a=r.url.replace(/:[a-z]+/gi,e=>o[e.substr(1)]?o[e.substr(1)]:e);let i=null;const u=n({},r);return delete u.url,delete u.method,Promise.resolve(t.httpRequestHandler[(r.method||"get").toLowerCase()](a,s,n({},l,u))).then(function(e){return i=e})}catch(e){return Promise.reject(e)}}handleNonImplemented(e){return this.logger&&this.logger.log&&this.logger.log(`${e} endpoint not implemented.`),Promise.resolve(null)}},exports.ApiHandler=t.__decorate([r.applyMagic],exports.ApiHandler),exports.HttpRequestErrorHandler=l,exports.createApiFetcher=(e=>new exports.ApiHandler(e));
//# sourceMappingURL=index.cjs.production.min.js.map
