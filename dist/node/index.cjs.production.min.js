"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("tslib"),s=require("js-magic"),r=(e=require("axios"))&&"object"==typeof e&&"default"in e?e.default:e;class n{constructor(e,t){this.logger=e,this.httpRequestErrorService=t}process(e){this.logger&&this.logger.warn&&this.logger.warn("API ERROR",e);let t=e;"string"==typeof e&&(t=new Error(e)),this.httpRequestErrorService&&(void 0!==this.httpRequestErrorService.process?this.httpRequestErrorService.process(t):"function"==typeof this.httpRequestErrorService&&this.httpRequestErrorService(t))}}exports.HttpRequestHandler=class{constructor({baseURL:e="",timeout:t=null,cancellable:s=!1,strategy:n=null,flattenResponse:l=null,defaultResponse:o={},logger:a=null,onError:i=null,...u}){this.timeout=3e4,this.cancellable=!1,this.strategy="silent",this.flattenResponse=!0,this.defaultResponse=null,this.timeout=null!==t?t:this.timeout,this.strategy=null!==n?n:this.strategy,this.cancellable=s||this.cancellable,this.flattenResponse=null!==l?l:this.flattenResponse,this.defaultResponse=o,this.logger=a||global.console||window.console||null,this.httpRequestErrorService=i,this.requestsQueue=new Map,this.requestInstance=r.create({...u,baseURL:e,timeout:this.timeout})}getInstance(){return this.requestInstance}interceptRequest(e){this.getInstance().interceptors.request.use(e)}__get(e){return e in this?this[e]:this.prepareRequest.bind(this,e)}prepareRequest(e,t,s=null,r=null){return this.handleRequest({type:e,url:t,data:s,config:r})}buildRequestConfig(e,t,s,r){const n=e.toLowerCase();return{...r,url:t,method:n,["get"===n||"head"===n?"params":"data"]:s||{}}}processRequestError(e,t){r.isCancel(e)||(t.onError&&"function"==typeof t.onError&&t.onError(e),new n(this.logger,this.httpRequestErrorService).process(e))}async outputErrorResponse(e,t){const s=t.cancelToken&&r.isCancel(e),n=t.strategy||this.strategy;return s&&!t.rejectCancelled?this.defaultResponse:"silent"===n?(await new Promise(()=>null),this.defaultResponse):"reject"===n||"throwError"===n?Promise.reject(e):this.defaultResponse}isRequestCancelled(e,t){return t.cancelToken&&r.isCancel(e)}addCancellationToken(e,t,s){if(!this.cancellable&&!s.cancellable)return{};if(void 0!==s.cancellable&&!s.cancellable)return{};const n=`${e}-${t}`,l=this.requestsQueue.get(n);l&&l.cancel();const o=r.CancelToken.source();this.requestsQueue.set(n,o);const a=this.requestsQueue.get(n)||{};return a.token?{cancelToken:a.token}:{}}async handleRequest({type:e,url:t,data:s=null,config:r=null}){let n=null,l=this.buildRequestConfig(e,t,s,r||{});l={...this.addCancellationToken(e,t,l),...l};try{n=await this.requestInstance.request(l)}catch(e){return this.processRequestError(e,l),this.outputErrorResponse(e,l)}return this.processResponseData(n)}processResponseData(e){return e.data?this.flattenResponse?"object"==typeof e.data&&void 0!==e.data.data&&1===Object.keys(e.data).length?e.data.data:e.data:e:this.defaultResponse}},exports.HttpRequestHandler=t.__decorate([s.applyMagic],exports.HttpRequestHandler),exports.ApiHandler=class{constructor({apiUrl:e,apiEndpoints:t,timeout:s=null,cancellable:r=!1,strategy:n=null,flattenResponse:l=null,defaultResponse:o={},logger:a=null,onError:i=null,...u}){this.apiUrl="",this.apiUrl=e,this.apiEndpoints=t,this.logger=a,this.httpRequestHandler=new exports.HttpRequestHandler({...u,baseURL:this.apiUrl,timeout:s,cancellable:r,strategy:n,flattenResponse:l,defaultResponse:o,logger:a,onError:i})}getInstance(){return this.httpRequestHandler.getInstance()}__get(e){return e in this?this[e]:this.apiEndpoints[e]?this.handleRequest.bind(this,e):this.handleNonImplemented.bind(this,e)}async handleRequest(...e){const t=this.apiEndpoints[e[0]],s=e[1]||{},r=e[2]||{},n=e[3]||{},l=t.url.replace(/:[a-z]+/gi,e=>r[e.substring(1)]?r[e.substring(1)]:e);let o=null;const a={...t};return delete a.url,delete a.method,o=await this.httpRequestHandler[(t.method||"get").toLowerCase()](l,s,{...n,...a}),o}handleNonImplemented(e){return this.logger&&this.logger.log&&this.logger.log(e+" endpoint not implemented."),Promise.resolve(null)}},exports.ApiHandler=t.__decorate([s.applyMagic],exports.ApiHandler),exports.HttpRequestErrorHandler=n,exports.createApiFetcher=e=>new exports.ApiHandler(e);
//# sourceMappingURL=index.cjs.production.min.js.map
