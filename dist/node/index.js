var C=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var H=(a,e)=>{for(var t in e)C(a,t,{get:e[t],enumerable:!0})},U=(a,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of E(e))!I.call(a,n)&&n!==t&&C(a,n,{get:()=>e[n],enumerable:!(s=D(e,n))||s.enumerable});return a};var x=a=>U(C({},"__esModule",{value:!0}),a);var S={};H(S,{createApiFetcher:()=>T,fetchf:()=>O});module.exports=x(S);async function w(a,e){if(!e)return a;let t=Array.isArray(e)?e:[e],s={...a};for(let n of t)s=await n(s);return s}async function P(a,e){if(!e)return a;let t=Array.isArray(e)?e:[e],s=a;for(let n of t)s=await n(s);return s}var b=class extends Error{response;request;config;status;statusText;constructor(e,t,s){super(e),this.name="ResponseError",this.message=e,this.status=s.status,this.statusText=s.statusText,this.request=t,this.config=t,this.response=s}};var R=class{requestInstance;baseURL="";timeout=3e4;cancellable=!1;rejectCancelled=!1;strategy="reject";method="get";flattenResponse=!1;defaultResponse=null;fetcher;logger;onError;requestsQueue;retry={retries:0,delay:1e3,maxDelay:3e4,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504],shouldRetry:async()=>!0};config;constructor({fetcher:e=null,timeout:t=null,rejectCancelled:s=!1,strategy:n=null,flattenResponse:o=null,defaultResponse:u={},logger:r=null,onError:i=null,...l}){this.fetcher=e,this.timeout=t??this.timeout,this.strategy=n||this.strategy,this.cancellable=l.cancellable||this.cancellable,this.rejectCancelled=s||this.rejectCancelled,this.flattenResponse=o||this.flattenResponse,this.defaultResponse=u,this.logger=r||(globalThis?globalThis.console:null)||null,this.onError=i,this.requestsQueue=new WeakMap,this.baseURL=l.baseURL||l.apiUrl||"",this.method=l.method||this.method,this.config=l,this.retry={...this.retry,...l.retry||{}},this.requestInstance=this.isCustomFetcher()?e.create({...l,baseURL:this.baseURL,timeout:this.timeout}):null}getInstance(){return this.requestInstance}replaceUrlPathParams(e,t){return t?e.replace(/:[a-zA-Z]+/gi,s=>{let n=s.substring(1);return String(t[n]?t[n]:s)}):e}appendQueryParams(e,t){if(!t)return e;let s=Object.entries(t).flatMap(([n,o])=>Array.isArray(o)?o.map(u=>`${encodeURIComponent(n)}[]=${encodeURIComponent(u)}`):`${encodeURIComponent(n)}=${encodeURIComponent(String(o))}`).join("&");return e.includes("?")?`${e}&${s}`:s?`${e}?${s}`:e}isJSONSerializable(e){if(e==null)return!1;let t=typeof e;if(t==="string"||t==="number"||t==="boolean")return!0;if(t!=="object")return!1;if(Array.isArray(e))return!0;if(Buffer.isBuffer(e)||e instanceof Date)return!1;let s=Object.getPrototypeOf(e);return s===Object.prototype||s===null||typeof e.toJSON=="function"}buildConfig(e,t,s){let n=s.method||this.method,o=n.toLowerCase(),u=o==="get"||o==="head",r=this.replaceUrlPathParams(e,s.urlPathParams||this.config.urlPathParams),i=s.body||s.data||this.config.body||this.config.data;if(this.isCustomFetcher())return{...s,url:r,method:o,...u?{params:t}:{},...!u&&t&&i?{params:t}:{},...!u&&t&&!i?{data:t}:{},...!u&&i?{data:i}:{}};let l=i||t,y=s.withCredentials||this.config.withCredentials?"include":s.credentials;delete s.data,delete s.withCredentials;let d=!u&&t&&!s.body||!t?r:this.appendQueryParams(r,t),h=d.includes("://")?"":typeof s.baseURL<"u"?s.baseURL:this.baseURL;return{...s,credentials:y,url:h+d,method:n.toUpperCase(),headers:{Accept:"application/json, text/plain, */*","Content-Type":"application/json;charset=utf-8",...s.headers||this.config.headers||{}},...u?{}:{body:!(l instanceof URLSearchParams)&&this.isJSONSerializable(l)?typeof l=="string"?l:JSON.stringify(l):l}}}processError(e,t){var s;this.isRequestCancelled(e)||((s=this.logger)!=null&&s.warn&&this.logger.warn("API ERROR",e),t.onError&&typeof t.onError=="function"&&t.onError(e),this.onError&&typeof this.onError=="function"&&this.onError(e))}async outputErrorResponse(e,t){let s=this.isRequestCancelled(e),n=t.strategy||this.strategy,o=typeof t.rejectCancelled<"u"?t.rejectCancelled:this.rejectCancelled,u=typeof t.defaultResponse<"u"?t.defaultResponse:this.defaultResponse;return n==="softFail"?this.outputResponse(e.response,t,e):s&&!o?u:n==="silent"?(await new Promise(()=>null),u):n==="reject"?Promise.reject(e):u}isRequestCancelled(e){return e.name==="AbortError"||e.name==="CanceledError"}isCustomFetcher(){return this.fetcher!==null}addCancellationToken(e){if(!this.cancellable&&!e.cancellable)return{};if(typeof e.cancellable<"u"&&!e.cancellable)return{};if(typeof AbortController>"u")return console.error("AbortController is unavailable."),{};let t=this.requestsQueue.get(e);t&&t.abort();let s=new AbortController;if(!this.isCustomFetcher()&&this.timeout>0){let n=setTimeout(()=>{let o=new Error(`[TimeoutError]: The ${e.url} request was aborted due to timeout`);throw o.name="TimeoutError",o.code=23,s.abort(o),clearTimeout(n),o},e.timeout||this.timeout)}return this.requestsQueue.set(e,s),{signal:s.signal}}async request(e,t=null,s=null){var q,F,j;let n=null,o=s||{},u=this.buildConfig(e,t,o),r={...this.addCancellationToken(u),...u},{retries:i,delay:l,backoff:y,retryOn:d,shouldRetry:g,maxDelay:h}={...this.retry,...(r==null?void 0:r.retry)||{}},f=0,m=l;for(;f<=i;)try{if(r=await w(r,r.onRequest),r=await w(r,this.config.onRequest),this.isCustomFetcher())n=await this.requestInstance.request(r);else{n=await globalThis.fetch(r.url,r);let c=String(((q=n==null?void 0:n.headers)==null?void 0:q.get("Content-Type"))||""),p,A=n.clone();if(!c)try{p=await A.json()}catch{}if(typeof p>"u"&&(c&&(c.includes("application/json")||c.includes("+json"))?p=await n.json():c.includes("multipart/form-data")?p=await n.formData():c.includes("application/octet-stream")?p=await n.blob():c.includes("application/x-www-form-urlencoded")?p=await n.formData():typeof n.text<"u"?p=await n.text():p=n.body||n.data||null),n.config=r,n.data=p,!n.ok)throw new b(`${r.url} failed! Status: ${n.status||null}`,r,n)}return n=await P(n,r.onResponse),n=await P(n,this.config.onResponse),this.outputResponse(n,r)}catch(c){if(f===i||!await g(c,f)||!(d!=null&&d.includes(((F=c==null?void 0:c.response)==null?void 0:F.status)||(c==null?void 0:c.status))))return this.processError(c,r),this.outputErrorResponse(c,r);(j=this.logger)!=null&&j.warn&&this.logger.warn(`Attempt ${f+1} failed. Retrying in ${m}ms...`),await this.delay(m),m*=y,m=Math.min(m,h),f++}return this.outputResponse(n,r)}async delay(e){return new Promise(t=>setTimeout(()=>t(!0),e))}processHeaders(e){if(!e.headers)return{};let t={};if(e.headers instanceof Headers)for(let[s,n]of e.headers.entries())t[s]=n;else t={...e.headers};return t}outputResponse(e,t,s=null){let n=typeof t.defaultResponse<"u"?t.defaultResponse:this.defaultResponse;return e?(t.flattenResponse||this.flattenResponse)&&typeof e.data<"u"?e.data!==null&&typeof e.data=="object"&&typeof e.data.data<"u"&&Object.keys(e.data).length===1?e.data.data:e.data:e!==null&&typeof e=="object"&&e.constructor===Object&&Object.keys(e).length===0?n:this.isCustomFetcher()?e:(s!==null&&(s==null||delete s.response,s==null||delete s.request,s==null||delete s.config),{body:e.body,blob:e.blob,json:e.json,text:e.text,clone:e.clone,bodyUsed:e.bodyUsed,arrayBuffer:e.arrayBuffer,formData:e.formData,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,error:s,data:e.data,headers:this.processHeaders(e),config:t}):n}};function T(a){let e=a.endpoints,t=new R(a);function s(){return t.getInstance()}function n(i){return console.error(`${i} endpoint must be added to 'endpoints'.`),Promise.resolve(null)}async function o(i,l={},y={},d={}){let h={...e[i]};return await t.request(h.url,l,{...h,...d,urlPathParams:y})}function u(i){return i in r?r[i]:e[i]?r.request.bind(null,i):n.bind(null,i)}let r={config:a,endpoints:e,requestHandler:t,getInstance:s,request:o};return new Proxy(r,{get:(i,l)=>u(l)})}async function O(a,e={}){return new R(e).request(a,e.body||e.data||e.params,e)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map