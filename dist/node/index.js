"use strict";var F=Object.defineProperty,re=Object.defineProperties,oe=Object.getOwnPropertyDescriptor,ae=Object.getOwnPropertyDescriptors,ie=Object.getOwnPropertyNames,W=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var k=(t,e,n)=>e in t?F(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m=(t,e)=>{for(var n in e||(e={}))Z.call(e,n)&&k(t,n,e[n]);if(W)for(var n of W(e))le.call(e,n)&&k(t,n,e[n]);return t},w=(t,e)=>re(t,ae(e));var ue=(t,e)=>{for(var n in e)F(t,n,{get:e[n],enumerable:!0})},ce=(t,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of ie(e))!Z.call(t,l)&&l!==n&&F(t,l,{get:()=>e[l],enumerable:!(o=oe(e,l))||o.enumerable});return t};var pe=t=>ce(F({},"__esModule",{value:!0}),t);var C=(t,e,n)=>k(t,typeof e!="symbol"?e+"":e,n);var me={};ue(me,{createApiFetcher:()=>fe,fetchf:()=>Re});module.exports=pe(me);async function L(t,e){if(!e)return t;let n=Array.isArray(e)?e:[e],o=m({},t);for(let l of n)o=await l(o);return o}async function $(t,e){if(!e)return t;let n=Array.isArray(e)?e:[e],o=t;for(let l of n)o=await l(o);return o}var U=class extends Error{constructor(n,o,l){super(n);C(this,"response");C(this,"request");C(this,"config");C(this,"status");C(this,"statusText");this.name="ResponseError",this.message=n,this.status=l.status,this.statusText=l.statusText,this.request=o,this.config=o,this.response=l}};function K(t,e){if(!e)return t;if(e instanceof URLSearchParams){let p=e.toString();return t.includes("?")?`${t}&${p}`:p?`${t}?${p}`:t}let n=[],o=function(p,r){r=typeof r=="function"?r():r,r=r===null||r===void 0?"":r,n[n.length]=encodeURIComponent(p)+"="+encodeURIComponent(r)},l=(p,r)=>{let d,g,s;if(p)if(Array.isArray(r))for(d=0,g=r.length;d<g;d++)l(p+"["+(typeof r[d]=="object"&&r[d]?d:"")+"]",r[d]);else if(typeof r=="object"&&r!==null)for(s in r)l(p+"["+s+"]",r[s]);else o(p,r);else if(Array.isArray(r))for(d=0,g=r.length;d<g;d++)o(r[d].name,r[d].value);else for(s in r)l(s,r[s]);return n},R=l("",e).join("&").replace(/%5B%5D/g,"[]");return t.includes("?")?`${t}&${R}`:R?`${t}?${R}`:t}function V(t,e){return e?t.replace(/:[a-zA-Z]+/gi,n=>{let o=n.substring(1);return String(e[o]?e[o]:n)}):t}function X(t){if(t==null)return!1;let e=typeof t;if(e==="string"||e==="number"||e==="boolean")return!0;if(e!=="object")return!1;if(Array.isArray(t))return!0;if(Buffer.isBuffer(t)||t instanceof Date)return!1;let n=Object.getPrototypeOf(t);return n===Object.prototype||n===null||typeof t.toJSON=="function"}async function v(t){return new Promise(e=>setTimeout(()=>e(!0),t))}function B(t){return t&&typeof t=="object"&&typeof t.data!="undefined"&&Object.keys(t).length===1?B(t.data):t}function ee(t){if(!t)return{};let e={};if(t instanceof Headers)t.forEach((n,o)=>{e[o]=n});else if(typeof t=="object"&&t!==null)for(let[n,o]of Object.entries(t))e[n.toLowerCase()]=o;return e}function D(t,e){t&&e in t&&delete t[e]}var T=new Map;async function te(t,e,n=0,o=!1,l=!0){let b=Date.now(),R=T.get(t);if(R){if(!R.isCancellable&&b-R.timestamp<n)return R.controller;R.isCancellable&&R.controller.abort(new DOMException("Aborted due to new request","AbortError")),R.timeoutId!==null&&clearTimeout(R.timeoutId),T.delete(t)}let p=new AbortController,r=l?setTimeout(()=>{let d=new DOMException(`${t.url} aborted due to timeout`,"TimeoutError");S(t,d)},e):null;return T.set(t,{controller:p,timeoutId:r,timestamp:b,isCancellable:o}),p}async function S(t,e=null){let n=T.get(t);n&&(e&&!n.controller.signal.aborted&&n.controller.abort(e),n.timeoutId!==null&&clearTimeout(n.timeoutId),T.delete(t))}var E="application/json",Q="Content-Type";async function ne(t){var o;if(!(t!=null&&t.body))return null;let e=String(((o=t.headers)==null?void 0:o.get(Q))||"").split(";")[0],n;try{if(e.includes(E)||e.includes("+json"))n=await t.json();else if(e.includes("multipart/form-data"))n=await t.formData();else if(e.includes("application/octet-stream"))n=await t.blob();else if(e.includes("application/x-www-form-urlencoded"))n=await t.formData();else if(e.includes("text/"))n=await t.text();else try{n=await t.clone().json()}catch(l){n=await t.text()}}catch(l){n=null}return n}var de={method:"GET",strategy:"reject",timeout:3e4,rejectCancelled:!1,dedupeTime:1e3,withCredentials:!1,flattenResponse:!1,defaultResponse:null,logger:null,fetcher:null,baseURL:"",retry:{retries:0,delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504],shouldRetry:async()=>!0}};function M(t){let e=m(w(m({},de),{baseURL:t.apiUrl||""}),t),n=()=>e.fetcher!==null,o=n()?e.fetcher.create(w(m({},t),{baseURL:e.baseURL,timeout:e.timeout})):null,l=()=>o,b=(s,c,a)=>{let u=(a.method||e.method).toUpperCase(),P=u==="GET"||u==="HEAD",i=V(s,a.urlPathParams||e.urlPathParams||null),A=a.params||e.params,O=a.body||a.data||e.body||e.data,H=!!(c&&(P||O)),y;if(P||(y=O||c),n())return w(m({},a),{method:u,url:i,params:H?c:A,data:y});let N=(typeof a.withCredentials!="undefined"?a.withCredentials:e.withCredentials)?"include":a.credentials||e.credentials||void 0;D(a,"data"),D(a,"withCredentials");let q=A||H?K(i,A||c):i,j=q.includes("://")?"":a.baseURL||e.baseURL;return y&&typeof y!="string"&&!(y instanceof URLSearchParams)&&X(y)&&(y=JSON.stringify(y)),w(m({},a),{credentials:N,body:y,method:u,url:j+q,headers:m(m({Accept:E+", text/plain, */*","Accept-Encoding":"gzip, deflate, br",[Q]:E+";charset=utf-8"},e.headers||{}),a.headers||{})})},R=(s,c)=>{var a;r(s)||((a=e.logger)!=null&&a.warn&&e.logger.warn("API ERROR",s),c.onError&&c.onError(s),e.onError&&e.onError(s))},p=async(s,c,a)=>{let u=r(s),P=a.strategy||e.strategy,i=typeof a.rejectCancelled!="undefined"?a.rejectCancelled:e.rejectCancelled;if(!(u&&!i)){if(P==="silent")await new Promise(()=>null);else if(P==="reject")return Promise.reject(s)}return g(c,a,s)},r=s=>s.name==="AbortError"||s.name==="CanceledError",d=async(s,c=null,a=null)=>{var z,G;let u=null,i=b(s,c,a||{}),A=typeof i.timeout!="undefined"?i.timeout:e.timeout,O=typeof i.cancellable!="undefined"?i.cancellable:e.cancellable,H=typeof i.dedupeTime!="undefined"?i.dedupeTime:e.dedupeTime,{retries:y,delay:_,backoff:N,retryOn:q,shouldRetry:J,maxDelay:j,resetTimeout:se}=m(m({},e.retry),(i==null?void 0:i.retry)||{}),x=0,I=_;for(;x<=y;)try{let h=(await te(i,A,H,O,A>0&&(!y||se))).signal,f=m({signal:h},i);if(f=await L(f,f==null?void 0:f.onRequest),f=await L(f,e==null?void 0:e.onRequest),n())u=await o.request(f);else if(u=await fetch(f.url,f),u.config=f,u.data=await ne(u),!u.ok)throw new U(`${f.url} failed! Status: ${u.status||null}`,f,u);return u=await $(u,f==null?void 0:f.onResponse),u=await $(u,e==null?void 0:e.onResponse),S(i),g(u,f)}catch(Y){let h=Y,f=((z=h==null?void 0:h.response)==null?void 0:z.status)||(h==null?void 0:h.status)||0;if(x===y||!await J(h,x)||!(q!=null&&q.includes(f)))return R(h,i),S(i),p(h,u,i);(G=e.logger)!=null&&G.warn&&e.logger.warn(`Attempt ${x+1} failed. Retrying in ${I}ms...`),await v(I),I*=N,I=Math.min(I,j),x++}return g(u,i)},g=(s,c,a=null)=>{let u=typeof c.defaultResponse!="undefined"?c.defaultResponse:e.defaultResponse,P=typeof c.flattenResponse!="undefined"?c.flattenResponse:e.flattenResponse;if(!s)return P?u:{error:a,headers:null,data:u,config:c};D(a,"response"),D(a,"request"),D(a,"config");let i=s==null?void 0:s.data;return(i==null||typeof i=="object"&&Object.keys(i).length===0)&&(i=u),P?B(i):n()?s:{body:s.body,blob:s.blob,json:s.json,text:s.text,clone:s.clone,bodyUsed:s.bodyUsed,arrayBuffer:s.arrayBuffer,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,error:a,data:i,headers:ee(s.headers),config:c}};return{getInstance:l,buildConfig:b,config:t,request:d}}function fe(t){let e=t.endpoints,n=M(t);function o(){return n.getInstance()}function l(r){return console.error(`${r} endpoint must be added to 'endpoints'.`),Promise.resolve(null)}async function b(r,d={},g={},s={}){let c=e[r];return await n.request(c.url,d,w(m(m({},c||{}),s),{urlPathParams:g}))}function R(r){return r in p?p[r]:e[r]?p.request.bind(null,r):l.bind(null,r)}let p={config:t,endpoints:e,requestHandler:n,getInstance:o,request:b};return new Proxy(p,{get:(r,d)=>R(d)})}async function Re(t,e={}){return M(e).request(t,null,e)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map