var g=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var C=(o,e)=>{for(var t in e)g(o,t,{get:e[t],enumerable:!0})},x=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of y(e))!E.call(o,n)&&n!==t&&g(o,n,{get:()=>e[n],enumerable:!(r=m(e,n))||r.enumerable});return o};var w=o=>x(g({},"__esModule",{value:!0}),o),f=(o,e,t,r)=>{for(var n=r>1?void 0:r?m(e,t):e,s=o.length-1,i;s>=0;s--)(i=o[s])&&(n=(r?i(e,t,n):i(n))||n);return r&&n&&g(e,t,n),n};var S={};C(S,{ApiHandler:()=>d,RequestErrorHandler:()=>h,RequestHandler:()=>p,createApiFetcher:()=>I});module.exports=w(S);var b=require("js-magic");var R=require("js-magic");var h=class{logger;requestErrorService;constructor(e,t){this.logger=e,this.requestErrorService=t}process(e){var r;(r=this.logger)!=null&&r.warn&&this.logger.warn("API ERROR",e);let t=e;typeof e=="string"&&(t=new Error(e)),this.requestErrorService&&(typeof this.requestErrorService.process<"u"?this.requestErrorService.process(t):typeof this.requestErrorService=="function"&&this.requestErrorService(t))}};var p=class{requestInstance;timeout=3e4;cancellable=!1;strategy="reject";flattenResponse=!0;defaultResponse=null;axios;logger;requestErrorService;requestsQueue;constructor({axios:e,baseURL:t="",timeout:r=null,cancellable:n=!1,strategy:s=null,flattenResponse:i=null,defaultResponse:l={},logger:a=null,onError:u=null,...c}){this.axios=e,this.timeout=r!==null?r:this.timeout,this.strategy=s!==null?s:this.strategy,this.cancellable=n||this.cancellable,this.flattenResponse=i!==null?i:this.flattenResponse,this.defaultResponse=l,this.logger=a||global.console||window.console||null,this.requestErrorService=u,this.requestsQueue=new Map,this.requestInstance=e.create({...c,baseURL:t,timeout:this.timeout})}getInstance(){return this.requestInstance}__get(e){return e in this?this[e]:this.prepareRequest.bind(this,e)}prepareRequest(e,t,r=null,n=null){return this.handleRequest({type:e,url:t,data:r,config:n})}buildRequestConfig(e,t,r,n){let s=e.toLowerCase();return{...n,url:t,method:s,[s==="get"||s==="head"?"params":"data"]:r||{}}}processRequestError(e,t){if(this.isRequestCancelled(e,t))return;t.onError&&typeof t.onError=="function"&&t.onError(e),new h(this.logger,this.requestErrorService).process(e)}async outputErrorResponse(e,t){let r=this.isRequestCancelled(e,t),n=t.strategy||this.strategy;return r&&!t.rejectCancelled?this.defaultResponse:n==="silent"?(await new Promise(()=>null),this.defaultResponse):n==="reject"||n==="throwError"?Promise.reject(e):this.defaultResponse}isRequestCancelled(e,t){return this.axios.isCancel(e)}addCancellationToken(e){if(!this.cancellable&&!e.cancellable)return{};if(typeof e.cancellable<"u"&&!e.cancellable)return{};if(typeof AbortController>"u")return console.error("AbortController is unavailable in your ENV."),{};let{method:t,baseURL:r,url:n,params:s,data:i}=e,l=JSON.stringify([t,r,n,s,i]).substring(0,55**5),a=this.requestsQueue.get(l);a&&a.abort();let u=new AbortController;return this.requestsQueue.set(l,u),{signal:u.signal}}async handleRequest({type:e,url:t,data:r=null,config:n=null}){let s=null,i=n||{},l=this.buildRequestConfig(e,t,r,i);l={...this.addCancellationToken(l),...l};try{s=await this.requestInstance.request(l)}catch(a){return this.processRequestError(a,l),this.outputErrorResponse(a,l)}return this.processResponseData(s)}processResponseData(e){return e.data?this.flattenResponse?typeof e.data=="object"&&typeof e.data.data<"u"&&Object.keys(e.data).length===1?e.data.data:e.data:e:this.defaultResponse}};p=f([R.applyMagic],p);var d=class{requestHandler;endpoints;logger;constructor({axios:e,apiUrl:t,endpoints:r,timeout:n=null,cancellable:s=!1,strategy:i=null,flattenResponse:l=null,defaultResponse:a={},logger:u=null,onError:c=null,...q}){this.endpoints=r,this.logger=u,this.requestHandler=new p({...q,baseURL:t,axios:e,timeout:n,cancellable:s,strategy:i,flattenResponse:l,defaultResponse:a,logger:u,onError:c})}getInstance(){return this.requestHandler.getInstance()}__get(e){return e in this?this[e]:this.endpoints[e]?this.handleRequest.bind(this,e):this.handleNonImplemented.bind(this,e)}async handleRequest(...e){let t=e[0],r=this.endpoints[t],n=e[1]||{},s=e[2]||{},i=e[3]||{},l=r.url.replace(/:[a-z]+/gi,c=>s[c.substring(1)]?s[c.substring(1)]:c),a=null,u={...r};return delete u.url,delete u.method,a=await this.requestHandler[(r.method||"get").toLowerCase()](l,n,{...i,...u}),a}handleNonImplemented(e){var t;return(t=this.logger)!=null&&t.log&&this.logger.log(`${e} endpoint not implemented.`),Promise.resolve(null)}};d=f([b.applyMagic],d);var I=o=>new d(o);0&&(module.exports={ApiHandler,RequestErrorHandler,RequestHandler,createApiFetcher});
//# sourceMappingURL=index.js.map