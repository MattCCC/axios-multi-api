"use strict";var Y=Object.defineProperty;var qe=Object.getOwnPropertyDescriptor;var we=Object.getOwnPropertyNames;var xe=Object.prototype.hasOwnProperty;var Oe=(e,t)=>{for(var n in t)Y(e,n,{get:t[n],enumerable:!0})},Fe=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of we(t))!xe.call(e,o)&&o!==n&&Y(e,o,{get:()=>t[o],enumerable:!(r=qe(t,o))||r.enumerable});return e};var Ie=e=>Fe(Y({},"__esModule",{value:!0}),e);var Ue={};Oe(Ue,{createApiFetcher:()=>He,fetchf:()=>Ne});module.exports=Ie(Ue);async function b(e,t){if(t){if(typeof t=="function"){let n=await t(e);n&&Object.assign(e,n)}else if(Array.isArray(t))for(let n of t){let r=await n(e);r&&Object.assign(e,r)}}}var B=class extends Error{response;request;config;status;statusText;constructor(t,n,r){super(t),this.name="ResponseError",this.message=t,this.status=r.status,this.statusText=r.statusText,this.request=n,this.config=n,this.response=r}};var M="application/",A=M+"json",Q="Content-Type",E="undefined",C="object",L="string",v="AbortError",ae="TimeoutError",ie="CanceledError",H="GET",le="HEAD";function V(e){return e instanceof URLSearchParams}function ce(e){let t="";for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t+=n+":"+e[n]);return t}function W(e){let t={},n=Object.keys(e);n.sort();for(let r=0,o=n.length;r<o;r++){let d=n[r];t[d]=e[d]}return t}function ue(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function fe(e,t){if(!t)return e;if(V(t)){let c=t.toString();return ue(e,c)}let n=[],r=encodeURIComponent,o=(c,a)=>{a=typeof a=="function"?a():a,a=a===null||a===void 0?"":a,n[n.length]=r(c)+"="+r(a)},d=(c,a)=>{let p,P,m;if(c)if(Array.isArray(a))for(p=0,P=a.length;p<P;p++)d(c+"["+(typeof a[p]===C&&a[p]?p:"")+"]",a[p]);else if(typeof a===C&&a!==null)for(m in a)d(c+"["+m+"]",a[m]);else o(c,a);else if(Array.isArray(a))for(p=0,P=a.length;p<P;p++)o(a[p].name,a[p].value);else for(m in a)d(m,a[m]);return n},R=d("",t).join("&").replace(/%5B%5D/g,"[]");return ue(e,R)}function pe(e,t){return t?e.replace(/:\w+/g,n=>{let r=n.substring(1);return t[r]?String(t[r]):n}):e}function de(e){let t=typeof e;if(t===E||e===null)return!1;if(t===L||t==="number"||t==="boolean"||Array.isArray(e))return!0;if(Buffer.isBuffer(e)||e instanceof Date)return!1;if(t===C){let n=Object.getPrototypeOf(e);if(n===Object.prototype||n===null||typeof e.toJSON=="function")return!0}return!1}async function X(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function Z(e){return e&&typeof e===C&&typeof e.data!==E&&Object.keys(e).length===1?Z(e.data):e}function Re(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((n,r)=>{t[r]=n});else if(typeof e===C&&e!==null)for(let[n,r]of Object.entries(e))t[n.toLowerCase()]=r;return t}function j(e,t){e&&t in e&&delete e[t]}var N=new Map;async function me(e,t,n=0,r=!1,o=!0){let d=Date.now(),h=N.get(e);if(h){let a=h[3],p=h[0],P=h[1];if(!a&&d-h[2]<n)return p;a&&p.abort(new DOMException("Aborted due to new request",v)),P!==null&&clearTimeout(P),N.delete(e)}let R=new AbortController,c=o?setTimeout(()=>{let a=new DOMException(`${e.url} aborted due to timeout`,ae);J(e,a)},t):null;return N.set(e,[R,c,d,r]),R}async function J(e,t=null){let n=N.get(e);if(n){let r=n[0],o=n[1];t&&!r.signal.aborted&&r.abort(t),o!==null&&clearTimeout(o),N.delete(e)}}async function ye(e){if(!e?.body)return null;let t=String(e.headers?.get(Q)||"").split(";")[0],n;try{if(t.includes(A)||t.includes("+json"))n=await e.json();else if(t.includes("multipart/form-data"))n=await e.formData();else if(t.includes(M+"octet-stream"))n=await e.blob();else if(t.includes(M+"x-www-form-urlencoded"))n=await e.formData();else if(t.includes("text/"))n=await e.text();else try{n=await e.clone().json()}catch{n=await e.text()}}catch{n=null}return n}function $(e){let t=0;for(let n=0,r=e.length;n<r;n++){let o=e.charCodeAt(n);t=t*31+o|0}return String(t)}var ee=new Map;function ge(e){let{url:t="",method:n=H,headers:r={},body:o="",mode:d="cors",credentials:h="include",cache:R="default",redirect:c="follow",referrer:a="",integrity:p=""}=e;if(R==="reload")return"";let P=ce(W(r)),m="";if(o!==null)if(typeof o=="string")m=$(o);else if(o instanceof FormData)o.forEach((T,s)=>{m+=s+"="+T+"&"}),m=$(m);else if(typeof Blob!==E&&o instanceof Blob||typeof File!==E&&o instanceof File)m="BF"+o.size+o.type;else if(o instanceof ArrayBuffer||ArrayBuffer.isView(o))m="AB"+o.byteLength;else{let T=typeof o===C?W(o):String(o);m=$(JSON.stringify(T))}return n+t+d+h+R+c+a+p+P+m}function Ae(e,t){return t?Date.now()-e>t*1e3:!1}function he(e,t){let n=ee.get(e);if(n){if(!Ae(n.timestamp,t))return n;ee.delete(e)}return null}function Pe(e,t,n=!1){ee.set(e,{data:t,isLoading:n,timestamp:Date.now()})}var te={method:H,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:A+", text/plain, */*","Accept-Encoding":"gzip, deflate, br",[Q]:A+";charset=utf-8"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function G(e){let t={...te,...e},n=(s,i,u,y)=>{y[s]&&(i[s]={...u[s],...y[s]})};n("retry",t,te,e),n("headers",t,te,e);let r=(s,i)=>typeof s[i]!==E?s[i]:t[i],o=r(e,"fetcher"),d=o?.create(t)||null,h=()=>d,R=(s,...i)=>{let u=r(s,"logger");u?.warn&&u.warn(...i)},c=(s,i)=>{let u=r(i,"method").toUpperCase(),y=u===H||u===le,l=pe(s,r(i,"urlPathParams")),g=r(i,"params"),U=r(i,"body")||r(i,"data"),D;y||(D=U);let S=r(i,"withCredentials")?"include":r(i,"credentials"),w=g?fe(l,g):l,k=w.includes("://")?"":r(i,"baseURL")||r(i,"apiUrl");return D&&typeof D!==L&&!V(D)&&de(D)&&(D=JSON.stringify(D)),{...i,credentials:S,body:D,method:u,url:k+w}},a=async(s,i)=>{P(s)||R(i,"API ERROR",s),await b(s,i?.onError),await b(s,t?.onError)},p=async(s,i,u)=>{let y=P(s),l=r(u,"strategy"),g=r(u,"rejectCancelled");if(!(y&&!g)){if(l==="silent")await new Promise(()=>null);else if(l==="reject")return Promise.reject(s)}return T(i,u,s)},P=s=>s.name===v||s.name===ie,m=async(s,i=null)=>{let u=i||{},y={...t,...u};n("retry",y,t,u),n("headers",y,t,u);let l=null,g=c(s,y),{timeout:U,cancellable:D,dedupeTime:ne,pollingInterval:S,shouldStopPolling:w,cacheTime:_,cacheKey:k}=y,q;if(k?q=k(g):q=ge(g),_&&q){let F=y.cacheBuster;if(!F||!F(g)){let f=he(q,_);if(f)return f.data}}let{retries:z=0,delay:De,backoff:Ce,retryOn:Ee,shouldRetry:re,maxDelay:Te,resetTimeout:be}=y.retry,x=0,K=0,O=De,se=z>0?z:0;for(;x<=se;)try{let f={signal:(await me(g,U,ne,D,!!(U&&(!se||be)))).signal,...g};if(await b(f,u?.onRequest),await b(f,t?.onRequest),o!==null&&d!==null?l=await d.request(f):l=await fetch(f.url,f),l instanceof Response&&(l.config=f,l.data=await ye(l),!l.ok))throw new B(`${f.url} failed! Status: ${l.status||null}`,f,l);if(await b(l,u?.onResponse),await b(l,t?.onResponse),J(g),S&&(!w||!w(l,K))){K++,R(f,"Polling attempt "+K+"..."),await X(S);continue}let I=T(l,f);if(_&&q){let oe=f.skipCache;(!oe||!oe(I,f))&&Pe(q,I)}return I}catch(F){let f=F,I=f?.response?.status||f?.status||0;if(x===z||!(!re||await re(f,x))||!Ee?.includes(I))return await a(f,g),J(g),p(f,l,g);R(y,`Attempt ${x+1} failed. Retry in ${O}ms.`),await X(O),O*=Ce,O=Math.min(O,Te),x++}return T(l,g)},T=(s,i,u=null)=>{let y=r(i,"defaultResponse");if(!s)return{ok:!1,error:u,data:y,headers:null,config:i};j(u,"response"),j(u,"request"),j(u,"config");let l=s?.data;return(l==null||typeof l===C&&Object.keys(l).length===0)&&(l=y),r(i,"flattenResponse")&&(s.data=Z(l)),s instanceof Response?{body:s.body,bodyUsed:s.bodyUsed,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,blob:s.blob.bind(s),json:s.json.bind(s),text:s.text.bind(s),clone:s.clone.bind(s),arrayBuffer:s.arrayBuffer.bind(s),error:u,data:l,headers:Re(s.headers),config:i}:s};return{getInstance:h,buildConfig:c,config:e,request:m}}function He(e){let t=e.endpoints,n=G(e);function r(){return n.getInstance()}function o(R){return console.error(`Add ${R} to 'endpoints'.`),Promise.resolve(null)}async function d(R,c={}){let a=t[R]||{url:R};return await n.request(a.url,{...a,...c})}let h={config:e,endpoints:t,requestHandler:n,getInstance:r,request:d};return new Proxy(h,{get(R,c){return c in h?h[c]:t[c]?h.request.bind(null,c):o.bind(null,c)}})}async function Ne(e,t={}){return G(t).request(e,t)}0&&(module.exports={createApiFetcher,fetchf});
//# sourceMappingURL=index.js.map