var xe=Object.defineProperty;var Oe=(e,t,n)=>t in e?xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var x=(e,t,n)=>Oe(e,typeof t!="symbol"?t+"":t,n);async function b(e,t){if(t){if(typeof t=="function"){let n=await t(e);n&&Object.assign(e,n)}else if(Array.isArray(t))for(let n of t){let r=await n(e);r&&Object.assign(e,r)}}}var _=class extends Error{constructor(n,r,a){super(n);x(this,"response");x(this,"request");x(this,"config");x(this,"status");x(this,"statusText");this.name="ResponseError",this.message=n,this.status=a.status,this.statusText=a.statusText,this.request=r,this.config=r,this.response=a}};var Q="application/",H=Q+"json",L="Content-Type",C="undefined",E="object",v="string",j="AbortError",le="TimeoutError",ue="CanceledError",N="GET",ce="HEAD";function W(e){return e instanceof URLSearchParams}function pe(e){let t="";for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t+=n+":"+e[n]);return t}function X(e){let t={},n=Object.keys(e);n.sort();for(let r=0,a=n.length;r<a;r++){let d=n[r];t[d]=e[d]}return t}function fe(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function de(e,t){if(!t)return e;if(W(t)){let f=t.toString();return fe(e,f)}let n=[],r=encodeURIComponent,a=(f,o)=>{o=typeof o=="function"?o():o,o=o===null||o===void 0?"":o,n[n.length]=r(f)+"="+r(o)},d=(f,o)=>{let p,P,m;if(f)if(Array.isArray(o))for(p=0,P=o.length;p<P;p++)d(f+"["+(typeof o[p]===E&&o[p]?p:"")+"]",o[p]);else if(typeof o===E&&o!==null)for(m in o)d(f+"["+m+"]",o[m]);else a(f,o);else if(Array.isArray(o))for(p=0,P=o.length;p<P;p++)a(o[p].name,o[p].value);else for(m in o)d(m,o[m]);return n},R=d("",t).join("&").replace(/%5B%5D/g,"[]");return fe(e,R)}function Re(e,t){return t?e.replace(/:\w+/g,n=>{let r=n.substring(1);return t[r]?String(t[r]):n}):e}function me(e){let t=typeof e;if(t===C||e===null)return!1;if(t===v||t==="number"||t==="boolean"||Array.isArray(e))return!0;if(Buffer.isBuffer(e)||e instanceof Date)return!1;if(t===E){let n=Object.getPrototypeOf(e);if(n===Object.prototype||n===null||typeof e.toJSON=="function")return!0}return!1}async function Z(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function ee(e){return e&&typeof e===E&&typeof e.data!==C&&Object.keys(e).length===1?ee(e.data):e}function ye(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((n,r)=>{t[r]=n});else if(typeof e===E&&e!==null)for(let[n,r]of Object.entries(e))t[n.toLowerCase()]=r;return t}function J(e,t){e&&t in e&&delete e[t]}var U=new Map;async function he(e,t,n=0,r=!1,a=!0){let d=Date.now(),g=U.get(e);if(g){let o=g[3],p=g[0],P=g[1];if(!o&&d-g[2]<n)return p;o&&p.abort(new DOMException("Aborted due to new request",j)),P!==null&&clearTimeout(P),U.delete(e)}let R=new AbortController,f=a?setTimeout(()=>{let o=new DOMException(`${e.url} aborted due to timeout`,le);$(e,o)},t):null;return U.set(e,[R,f,d,r]),R}async function $(e,t=null){let n=U.get(e);if(n){let r=n[0],a=n[1];t&&!r.signal.aborted&&r.abort(t),a!==null&&clearTimeout(a),U.delete(e)}}async function ge(e){var r;if(!(e!=null&&e.body))return null;let t=String(((r=e.headers)==null?void 0:r.get(L))||"").split(";")[0],n;try{if(t.includes(H)||t.includes("+json"))n=await e.json();else if(t.includes("multipart/form-data"))n=await e.formData();else if(t.includes(Q+"octet-stream"))n=await e.blob();else if(t.includes(Q+"x-www-form-urlencoded"))n=await e.formData();else if(t.includes("text/"))n=await e.text();else try{n=await e.clone().json()}catch(a){n=await e.text()}}catch(a){n=null}return n}function G(e){let t=0;for(let n=0,r=e.length;n<r;n++){let a=e.charCodeAt(n);t=t*31+a|0}return String(t)}var te=new Map;function Pe(e){let{url:t="",method:n=N,headers:r={},body:a="",mode:d="cors",credentials:g="include",cache:R="default",redirect:f="follow",referrer:o="",integrity:p=""}=e;if(R==="reload")return"";let P=pe(X(r)),m="";if(a!==null)if(typeof a=="string")m=G(a);else if(a instanceof FormData)a.forEach((T,s)=>{m+=s+"="+T+"&"}),m=G(m);else if(typeof Blob!==C&&a instanceof Blob||typeof File!==C&&a instanceof File)m="BF"+a.size+a.type;else if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))m="AB"+a.byteLength;else{let T=typeof a===E?X(a):String(a);m=G(JSON.stringify(T))}return n+t+d+g+R+f+o+p+P+m}function qe(e,t){return t?Date.now()-e>t*1e3:!1}function De(e,t){let n=te.get(e);if(n){if(!qe(n.timestamp,t))return n;te.delete(e)}return null}function Ee(e,t,n=!1){te.set(e,{data:t,isLoading:n,timestamp:Date.now()})}var ne={method:N,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:H+", text/plain, */*","Accept-Encoding":"gzip, deflate, br",[L]:H+";charset=utf-8"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function z(e){let t={...ne,...e},n=(s,i,l,y)=>{y[s]&&(i[s]={...l[s],...y[s]})};n("retry",t,ne,e),n("headers",t,ne,e);let r=(s,i)=>typeof s[i]!==C?s[i]:t[i],a=r(e,"fetcher"),d=(a==null?void 0:a.create(t))||null,g=()=>d,R=(s,...i)=>{let l=r(s,"logger");l!=null&&l.warn&&l.warn(...i)},f=(s,i)=>{let l=r(i,"method").toUpperCase(),y=l===N||l===ce,u=Re(s,r(i,"urlPathParams")),h=r(i,"params"),S=r(i,"body")||r(i,"data"),D;y||(D=S);let k=r(i,"withCredentials")?"include":r(i,"credentials"),O=h?de(u,h):u,M=O.includes("://")?"":r(i,"baseURL")||r(i,"apiUrl");return D&&typeof D!==v&&!W(D)&&me(D)&&(D=JSON.stringify(D)),{...i,credentials:k,body:D,method:l,url:M+O}},o=async(s,i)=>{P(s)||R(i,"API ERROR",s),await b(s,i==null?void 0:i.onError),await b(s,t==null?void 0:t.onError)},p=async(s,i,l)=>{let y=P(s),u=r(l,"strategy"),h=r(l,"rejectCancelled");if(!(y&&!h)){if(u==="silent")await new Promise(()=>null);else if(u==="reject")return Promise.reject(s)}return T(i,l,s)},P=s=>s.name===j||s.name===ue,m=async(s,i=null)=>{var oe;let l=i||{},y={...t,...l};n("retry",y,t,l),n("headers",y,t,l);let u=null,h=f(s,y),{timeout:S,cancellable:D,dedupeTime:se,pollingInterval:k,shouldStopPolling:O,cacheTime:B,cacheKey:M}=y,w;if(M?w=M(h):w=Pe(h),B&&w){let I=y.cacheBuster;if(!I||!I(h)){let c=De(w,B);if(c)return c.data}}let{retries:K=0,delay:Ce,backoff:Te,retryOn:Y,shouldRetry:re,maxDelay:be,resetTimeout:we}=y.retry,q=0,V=0,F=Ce,ae=K>0?K:0;for(;q<=ae;)try{let c={signal:(await he(h,S,se,D,!!(S&&(!ae||we)))).signal,...h};if(await b(c,l==null?void 0:l.onRequest),await b(c,t==null?void 0:t.onRequest),a!==null&&d!==null?u=await d.request(c):u=await fetch(c.url,c),u instanceof Response&&(u.config=c,u.data=await ge(u),!u.ok))throw new _(`${c.url} failed! Status: ${u.status||null}`,c,u);if(await b(u,l==null?void 0:l.onResponse),await b(u,t==null?void 0:t.onResponse),$(h),k&&(!O||!O(u,V))){V++,R(c,"Polling attempt "+V+"..."),await Z(k);continue}let A=T(u,c);if(B&&w){let ie=c.skipCache;(!ie||!ie(A,c))&&Ee(w,A)}return A}catch(I){let c=I,A=((oe=c==null?void 0:c.response)==null?void 0:oe.status)||(c==null?void 0:c.status)||0;if(q===K||!(!re||await re(c,q))||!(Y!=null&&Y.includes(A)))return await o(c,h),$(h),p(c,u,h);R(y,`Attempt ${q+1} failed. Retry in ${F}ms.`),await Z(F),F*=Te,F=Math.min(F,be),q++}return T(u,h)},T=(s,i,l=null)=>{let y=r(i,"defaultResponse");if(!s)return{ok:!1,error:l,data:y,headers:null,config:i};J(l,"response"),J(l,"request"),J(l,"config");let u=s==null?void 0:s.data;return(u==null||typeof u===E&&Object.keys(u).length===0)&&(u=y),r(i,"flattenResponse")&&(s.data=ee(u)),s instanceof Response?{body:s.body,bodyUsed:s.bodyUsed,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,blob:s.blob.bind(s),json:s.json.bind(s),text:s.text.bind(s),clone:s.clone.bind(s),arrayBuffer:s.arrayBuffer.bind(s),error:l,data:u,headers:ye(s.headers),config:i}:s};return{getInstance:g,buildConfig:f,config:e,request:m}}function et(e){let t=e.endpoints,n=z(e);function r(){return n.getInstance()}function a(R){return console.error(`Add ${R} to 'endpoints'.`),Promise.resolve(null)}async function d(R,f={}){let o=t[R]||{url:R};return await n.request(o.url,{...o,...f})}let g={config:e,endpoints:t,requestHandler:n,getInstance:r,request:d};return new Proxy(g,{get(R,f){return f in g?g[f]:t[f]?g.request.bind(null,f):a.bind(null,f)}})}async function st(e,t={}){return z(t).request(e,t)}export{et as createApiFetcher,st as fetchf};
//# sourceMappingURL=index.mjs.map