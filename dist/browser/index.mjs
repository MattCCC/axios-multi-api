var be=Object.defineProperty;var we=(e,t,n)=>t in e?be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var w=(e,t,n)=>we(e,typeof t!="symbol"?t+"":t,n);async function T(e,t){if(t){if(typeof t=="function"){let n=await t(e);n&&Object.assign(e,n)}else if(Array.isArray(t))for(let n of t){let o=await n(e);o&&Object.assign(e,o)}}}var M=class extends Error{constructor(n,o,r){super(n);w(this,"response");w(this,"request");w(this,"config");w(this,"status");w(this,"statusText");this.name="ResponseError",this.message=n,this.status=r.status,this.statusText=r.statusText,this.request=o,this.config=o,this.response=r}};var _="application/",A=_+"json",Q="Content-Type",C="undefined",E="object",L="string",v="AbortError",oe="TimeoutError",ie="CanceledError",N="GET",le="HEAD";function V(e){return e instanceof URLSearchParams}function ce(e){let t="";for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t+=n+":"+e[n]);return t}function W(e){let t={},n=Object.keys(e);n.sort();for(let o=0,r=n.length;o<r;o++){let u=n[o];t[u]=e[u]}return t}function ue(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function fe(e,t){if(!t)return e;if(V(t)){let f=t.toString();return ue(e,f)}let n=[],o=encodeURIComponent,r=(f,a)=>{a=typeof a=="function"?a():a,a=a===null||a===void 0?"":a,n[n.length]=o(f)+"="+o(a)},u=(f,a)=>{let p,g,R;if(f)if(Array.isArray(a))for(p=0,g=a.length;p<g;p++)u(f+"["+(typeof a[p]===E&&a[p]?p:"")+"]",a[p]);else if(typeof a===E&&a!==null)for(R in a)u(f+"["+R+"]",a[R]);else r(f,a);else if(Array.isArray(a))for(p=0,g=a.length;p<g;p++)r(a[p].name,a[p].value);else for(R in a)u(R,a[R]);return n},y=u("",t).join("&").replace(/%5B%5D/g,"[]");return ue(e,y)}function pe(e,t){return t?e.replace(/:\w+/g,n=>{let o=n.substring(1);return t[o]?String(t[o]):n}):e}function de(e){let t=typeof e;if(t===C||e===null)return!1;if(t===L||t==="number"||t==="boolean"||Array.isArray(e))return!0;if(Buffer.isBuffer(e)||e instanceof Date)return!1;if(t===E){let n=Object.getPrototypeOf(e);if(n===Object.prototype||n===null||typeof e.toJSON=="function")return!0}return!1}async function X(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function Z(e){return e&&typeof e===E&&typeof e.data!==C&&Object.keys(e).length===1?Z(e.data):e}function Re(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((n,o)=>{t[o]=n});else if(typeof e===E&&e!==null)for(let[n,o]of Object.entries(e))t[n.toLowerCase()]=o;return t}function j(e,t){e&&t in e&&delete e[t]}var H=new Map;async function me(e,t,n=0,o=!1,r=!0){let u=Date.now(),m=H.get(e);if(m){let a=m[3],p=m[0],g=m[1];if(!a&&u-m[2]<n)return p;a&&p.abort(new DOMException("Aborted due to new request",v)),g!==null&&clearTimeout(g),H.delete(e)}let y=new AbortController,f=r?setTimeout(()=>{let a=new DOMException(`${e.url} aborted due to timeout`,oe);J(e,a)},t):null;return H.set(e,[y,f,u,o]),y}async function J(e,t=null){let n=H.get(e);if(n){let o=n[0],r=n[1];t&&!o.signal.aborted&&o.abort(t),r!==null&&clearTimeout(r),H.delete(e)}}async function ye(e){var o;if(!(e!=null&&e.body))return null;let t=String(((o=e.headers)==null?void 0:o.get(Q))||"").split(";")[0],n;try{if(t.includes(A)||t.includes("+json"))n=await e.json();else if(t.includes("multipart/form-data"))n=await e.formData();else if(t.includes(_+"octet-stream"))n=await e.blob();else if(t.includes(_+"x-www-form-urlencoded"))n=await e.formData();else if(t.includes("text/"))n=await e.text();else try{n=await e.clone().json()}catch(r){n=await e.text()}}catch(r){n=null}return n}function $(e){let t=0;for(let n=0,o=e.length;n<o;n++){let r=e.charCodeAt(n);t=t*31+r|0}return String(t)}var ee=new Map;function he(e){let{url:t="",method:n=N,headers:o={},body:r="",mode:u="cors",credentials:m="include",cache:y="default",redirect:f="follow",referrer:a="",integrity:p=""}=e;if(y==="reload")return"";let g=ce(W(o)),R="";if(r!==null)if(typeof r=="string")R=$(r);else if(r instanceof FormData)r.forEach((s,i)=>{R+=i+"="+s+"&"}),R=$(R);else if(typeof Blob!==C&&r instanceof Blob||typeof File!==C&&r instanceof File)R="BF"+r.size+r.type;else if(r instanceof ArrayBuffer||ArrayBuffer.isView(r))R="AB"+r.byteLength;else{let s=typeof r===E?W(r):String(r);R=$(JSON.stringify(s))}return n+t+u+m+y+f+a+p+g+R}function xe(e,t){return t?Date.now()-e>t*1e3:!1}function ge(e,t){let n=ee.get(e);if(n){if(!xe(n.timestamp,t))return n;ee.delete(e)}return null}function Pe(e,t,n=!1){ee.set(e,{data:t,isLoading:n,timestamp:Date.now()})}var Oe={method:N,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:A+", text/plain, */*","Accept-Encoding":"gzip, deflate, br",[Q]:A+";charset=utf-8"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function G(e){let t={...Oe,...e},n=t.fetcher,o=(n==null?void 0:n.create(t))||null,r=()=>o,u=(s,i)=>typeof s[i]!==C?s[i]:t[i],m=(...s)=>{var i;(i=t.logger)!=null&&i.warn&&t.logger.warn(...s)},y=(s,i)=>{let d=u(i,"method").toUpperCase(),P=d===N||d===le,l=pe(s,u(i,"urlPathParams")),h=u(i,"params"),U=u(i,"body")||u(i,"data"),D;P||(D=U);let S=u(i,"withCredentials")?"include":u(i,"credentials"),x=h?fe(l,h):l,k=x.includes("://")?"":u(i,"baseURL")||u(i,"apiUrl");return D&&typeof D!==L&&!V(D)&&de(D)&&(D=JSON.stringify(D)),{...i,credentials:S,body:D,method:d,url:k+x}},f=async(s,i)=>{p(s)||m("API ERROR",s),await T(s,i==null?void 0:i.onError),await T(s,t==null?void 0:t.onError)},a=async(s,i,d)=>{let P=p(s),l=u(d,"strategy"),h=u(d,"rejectCancelled");if(!(P&&!h)){if(l==="silent")await new Promise(()=>null);else if(l==="reject")return Promise.reject(s)}return R(i,d,s)},p=s=>s.name===v||s.name===ie,g=async(s,i=null)=>{var re;let d=i||{},P={...t,...d},l=null,h=y(s,P),{timeout:U,cancellable:D,dedupeTime:te,pollingInterval:S,shouldStopPolling:x,cacheTime:B,cacheKey:k}=P,b;if(k?b=k(h):b=he(h),B&&b){let I=P.cacheBuster;if(!I||!I(h)){let c=ge(b,B);if(c)return c.data}}let{retries:z=0,delay:De,backoff:Ee,retryOn:Y,shouldRetry:ne,maxDelay:Ce,resetTimeout:Te}=P.retry,O=0,K=0,F=De,se=z>0?z:0;for(;O<=se;)try{let c={signal:(await me(h,U,te,D,!!(U&&(!se||Te)))).signal,...h};if(await T(c,d==null?void 0:d.onRequest),await T(c,t==null?void 0:t.onRequest),n!==null&&o!==null?l=await o.request(c):l=await fetch(c.url,c),l instanceof Response&&(l.config=c,l.data=await ye(l),!l.ok))throw new M(`${c.url} failed! Status: ${l.status||null}`,c,l);if(await T(l,d==null?void 0:d.onResponse),await T(l,t==null?void 0:t.onResponse),J(h),S&&(!x||!x(l,K))){K++,m(`Polling attempt ${K}...`),await X(S);continue}let q=R(l,c);if(B&&b){let ae=c.skipCache;(!ae||!ae(q,c))&&Pe(b,q)}return q}catch(I){let c=I,q=((re=c==null?void 0:c.response)==null?void 0:re.status)||(c==null?void 0:c.status)||0;if(O===z||!(!ne||await ne(c,O))||!(Y!=null&&Y.includes(q)))return await f(c,h),J(h),a(c,l,h);m(`Attempt ${O+1} failed. Retry in ${F}ms.`),await X(F),F*=Ee,F=Math.min(F,Ce),O++}return R(l,h)},R=(s,i,d=null)=>{let P=u(i,"defaultResponse");if(!s)return{ok:!1,error:d,data:P,headers:null,config:i};j(d,"response"),j(d,"request"),j(d,"config");let l=s==null?void 0:s.data;return(l==null||typeof l===E&&Object.keys(l).length===0)&&(l=P),u(i,"flattenResponse")&&(s.data=Z(l)),s instanceof Response?{body:s.body,bodyUsed:s.bodyUsed,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,blob:s.blob.bind(s),json:s.json.bind(s),text:s.text.bind(s),clone:s.clone.bind(s),arrayBuffer:s.arrayBuffer.bind(s),error:d,data:l,headers:Re(s.headers),config:i}:s};return{getInstance:r,buildConfig:y,config:e,request:g}}function Ze(e){let t=e.endpoints,n=G(e);function o(){return n.getInstance()}function r(y){return console.error(`Add ${y} to 'endpoints'.`),Promise.resolve(null)}async function u(y,f={}){let a=t[y]||{url:y};return await n.request(a.url,{...a,...f})}let m={config:e,endpoints:t,requestHandler:n,getInstance:o,request:u};return new Proxy(m,{get(y,f){return f in m?m[f]:t[f]?m.request.bind(null,f):r.bind(null,f)}})}async function nt(e,t={}){return G(t).request(e,t)}export{Ze as createApiFetcher,nt as fetchf};
//# sourceMappingURL=index.mjs.map