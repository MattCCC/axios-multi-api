var ne=Object.defineProperty,se=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var j=(t,e,n)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,m=(t,e)=>{for(var n in e||(e={}))oe.call(e,n)&&j(t,n,e[n]);if(Y)for(var n of Y(e))ae.call(e,n)&&j(t,n,e[n]);return t},w=(t,e)=>se(t,re(e));var C=(t,e,n)=>j(t,typeof e!="symbol"?e+"":e,n);async function k(t,e){if(!e)return t;let n=Array.isArray(e)?e:[e],a=m({},t);for(let u of n)a=await u(a);return a}async function L(t,e){if(!e)return t;let n=Array.isArray(e)?e:[e],a=t;for(let u of n)a=await u(a);return a}var F=class extends Error{constructor(n,a,u){super(n);C(this,"response");C(this,"request");C(this,"config");C(this,"status");C(this,"statusText");this.name="ResponseError",this.message=n,this.status=u.status,this.statusText=u.statusText,this.request=a,this.config=a,this.response=u}};function W(t,e){if(!e)return t;if(e instanceof URLSearchParams){let p=e.toString();return t.includes("?")?`${t}&${p}`:p?`${t}?${p}`:t}let n=[],a=function(p,r){r=typeof r=="function"?r():r,r=r===null||r===void 0?"":r,n[n.length]=encodeURIComponent(p)+"="+encodeURIComponent(r)},u=(p,r)=>{let d,g,s;if(p)if(Array.isArray(r))for(d=0,g=r.length;d<g;d++)u(p+"["+(typeof r[d]=="object"&&r[d]?d:"")+"]",r[d]);else if(typeof r=="object"&&r!==null)for(s in r)u(p+"["+s+"]",r[s]);else a(p,r);else if(Array.isArray(r))for(d=0,g=r.length;d<g;d++)a(r[d].name,r[d].value);else for(s in r)u(s,r[s]);return n},R=u("",e).join("&").replace(/%5B%5D/g,"[]");return t.includes("?")?`${t}&${R}`:R?`${t}?${R}`:t}function Z(t,e){return e?t.replace(/:[a-zA-Z]+/gi,n=>{let a=n.substring(1);return String(e[a]?e[a]:n)}):t}function K(t){if(t==null)return!1;let e=typeof t;if(e==="string"||e==="number"||e==="boolean")return!0;if(e!=="object")return!1;if(Array.isArray(t))return!0;if(Buffer.isBuffer(t)||t instanceof Date)return!1;let n=Object.getPrototypeOf(t);return n===Object.prototype||n===null||typeof t.toJSON=="function"}async function V(t){return new Promise(e=>setTimeout(()=>e(!0),t))}function $(t){return t&&typeof t=="object"&&typeof t.data!="undefined"&&Object.keys(t).length===1?$(t.data):t}function X(t){if(!t)return{};let e={};if(t instanceof Headers)t.forEach((n,a)=>{e[a]=n});else if(typeof t=="object"&&t!==null)for(let[n,a]of Object.entries(t))e[n.toLowerCase()]=a;return e}function D(t,e){t&&e in t&&delete t[e]}var T=new Map;async function v(t,e,n=0,a=!1,u=!0){let b=Date.now(),R=T.get(t);if(R){if(!R.isCancellable&&b-R.timestamp<n)return R.controller;R.isCancellable&&R.controller.abort(new DOMException("Aborted due to new request","AbortError")),R.timeoutId!==null&&clearTimeout(R.timeoutId),T.delete(t)}let p=new AbortController,r=u?setTimeout(()=>{let d=new DOMException(`${t.url} aborted due to timeout`,"TimeoutError");U(t,d)},e):null;return T.set(t,{controller:p,timeoutId:r,timestamp:b,isCancellable:a}),p}async function U(t,e=null){let n=T.get(t);n&&(e&&!n.controller.signal.aborted&&n.controller.abort(e),n.timeoutId!==null&&clearTimeout(n.timeoutId),T.delete(t))}var E="application/json",S="Content-Type";async function ee(t){var a;if(!(t!=null&&t.body))return null;let e=String(((a=t.headers)==null?void 0:a.get(S))||"").split(";")[0],n;try{if(e.includes(E)||e.includes("+json"))n=await t.json();else if(e.includes("multipart/form-data"))n=await t.formData();else if(e.includes("application/octet-stream"))n=await t.blob();else if(e.includes("application/x-www-form-urlencoded"))n=await t.formData();else if(e.includes("text/"))n=await t.text();else try{n=await t.clone().json()}catch(u){n=await t.text()}}catch(u){n=null}return n}var ie={method:"GET",strategy:"reject",timeout:3e4,rejectCancelled:!1,dedupeTime:1e3,withCredentials:!1,flattenResponse:!1,defaultResponse:null,logger:null,fetcher:null,baseURL:"",retry:{retries:0,delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504],shouldRetry:async()=>!0}};function Q(t){let e=m(w(m({},ie),{baseURL:t.apiUrl||""}),t),n=()=>e.fetcher!==null,a=n()?e.fetcher.create(w(m({},t),{baseURL:e.baseURL,timeout:e.timeout})):null,u=()=>a,b=(s,c,o)=>{let l=(o.method||e.method).toUpperCase(),P=l==="GET"||l==="HEAD",i=Z(s,o.urlPathParams||e.urlPathParams||null),A=o.params||e.params,O=o.body||o.data||e.body||e.data,H=!!(c&&(P||O)),y;if(P||(y=O||c),n())return w(m({},o),{method:l,url:i,params:H?c:A,data:y});let M=(typeof o.withCredentials!="undefined"?o.withCredentials:e.withCredentials)?"include":o.credentials||e.credentials||void 0;D(o,"data"),D(o,"withCredentials");let q=A||H?W(i,A||c):i,N=q.includes("://")?"":o.baseURL||e.baseURL;return y&&typeof y!="string"&&!(y instanceof URLSearchParams)&&K(y)&&(y=JSON.stringify(y)),w(m({},o),{credentials:M,body:y,method:l,url:N+q,headers:m(m({Accept:E+", text/plain, */*","Accept-Encoding":"gzip, deflate, br",[S]:E+";charset=utf-8"},e.headers||{}),o.headers||{})})},R=(s,c)=>{var o;r(s)||((o=e.logger)!=null&&o.warn&&e.logger.warn("API ERROR",s),c.onError&&c.onError(s),e.onError&&e.onError(s))},p=async(s,c,o)=>{let l=r(s),P=o.strategy||e.strategy,i=typeof o.rejectCancelled!="undefined"?o.rejectCancelled:e.rejectCancelled;if(!(l&&!i)){if(P==="silent")await new Promise(()=>null);else if(P==="reject")return Promise.reject(s)}return g(c,o,s)},r=s=>s.name==="AbortError"||s.name==="CanceledError",d=async(s,c=null,o=null)=>{var J,z;let l=null,i=b(s,c,o||{}),A=typeof i.timeout!="undefined"?i.timeout:e.timeout,O=typeof i.cancellable!="undefined"?i.cancellable:e.cancellable,H=typeof i.dedupeTime!="undefined"?i.dedupeTime:e.dedupeTime,{retries:y,delay:B,backoff:M,retryOn:q,shouldRetry:_,maxDelay:N,resetTimeout:te}=m(m({},e.retry),(i==null?void 0:i.retry)||{}),x=0,I=B;for(;x<=y;)try{let h=(await v(i,A,H,O,A>0&&(!y||te))).signal,f=m({signal:h},i);if(f=await k(f,f==null?void 0:f.onRequest),f=await k(f,e==null?void 0:e.onRequest),n())l=await a.request(f);else if(l=await fetch(f.url,f),l.config=f,l.data=await ee(l),!l.ok)throw new F(`${f.url} failed! Status: ${l.status||null}`,f,l);return l=await L(l,f==null?void 0:f.onResponse),l=await L(l,e==null?void 0:e.onResponse),U(i),g(l,f)}catch(G){let h=G,f=((J=h==null?void 0:h.response)==null?void 0:J.status)||(h==null?void 0:h.status)||0;if(x===y||!await _(h,x)||!(q!=null&&q.includes(f)))return R(h,i),U(i),p(h,l,i);(z=e.logger)!=null&&z.warn&&e.logger.warn(`Attempt ${x+1} failed. Retrying in ${I}ms...`),await V(I),I*=M,I=Math.min(I,N),x++}return g(l,i)},g=(s,c,o=null)=>{let l=typeof c.defaultResponse!="undefined"?c.defaultResponse:e.defaultResponse,P=typeof c.flattenResponse!="undefined"?c.flattenResponse:e.flattenResponse;if(!s)return P?l:{error:o,headers:null,data:l,config:c};D(o,"response"),D(o,"request"),D(o,"config");let i=s==null?void 0:s.data;return(i==null||typeof i=="object"&&Object.keys(i).length===0)&&(i=l),P?$(i):n()?s:{body:s.body,blob:s.blob,json:s.json,text:s.text,clone:s.clone,bodyUsed:s.bodyUsed,arrayBuffer:s.arrayBuffer,formData:s.formData,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,status:s.status,statusText:s.statusText,error:o,data:i,headers:X(s.headers),config:c}};return{getInstance:u,buildConfig:b,config:t,request:d}}function Ee(t){let e=t.endpoints,n=Q(t);function a(){return n.getInstance()}function u(r){return console.error(`${r} endpoint must be added to 'endpoints'.`),Promise.resolve(null)}async function b(r,d={},g={},s={}){let c=e[r];return await n.request(c.url,d,w(m(m({},c||{}),s),{urlPathParams:g}))}function R(r){return r in p?p[r]:e[r]?p.request.bind(null,r):u.bind(null,r)}let p={config:t,endpoints:e,requestHandler:n,getInstance:a,request:b};return new Proxy(p,{get:(r,d)=>R(d)})}async function Ue(t,e={}){return Q(e).request(t,null,e)}export{Ee as createApiFetcher,Ue as fetchf};
//# sourceMappingURL=index.mjs.map