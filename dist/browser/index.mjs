var De=Object.defineProperty,Ie=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var Z=(e,t,n)=>t in e?De(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))Fe.call(t,n)&&Z(e,n,t[n]);if(ce)for(var n of ce(t))qe.call(t,n)&&Z(e,n,t[n]);return e},B=(e,t)=>Ie(e,Ae(t));var A=(e,t,n)=>Z(e,typeof t!="symbol"?t+"":t,n);async function O(e,t){if(t){if(typeof t=="function"){let n=await t(e);n&&Object.assign(e,n)}else if(Array.isArray(t))for(let n of t){let a=await n(e);a&&Object.assign(e,a)}}}var _=class extends Error{constructor(n,a,o){super(n);A(this,"response");A(this,"request");A(this,"config");A(this,"status");A(this,"statusText");this.name="ResponseError",this.message=n,this.status=o.status,this.statusText=o.statusText,this.request=a,this.config=a,this.response=o}};var M="application/json",L="Content-Type",x="undefined",b="object",j="string",J="AbortError",le="TimeoutError",ue="CanceledError",U="GET",fe="HEAD";function ee(e){return e instanceof URLSearchParams}function de(e){let t="";for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t+=n+":"+e[n]);return t}function te(e){let t={},n=Object.keys(e);n.sort();for(let a=0,o=n.length;a<o;a++){let i=n[a];t[i]=e[i]}return t}function pe(e,t){return t?e.includes("?")?`${e}&${t}`:`${e}?${t}`:e}function ye(e,t){if(!t)return e;if(ee(t)){let l=t.toString();return pe(e,l)}let n=[],a=encodeURIComponent,o=(l,s)=>{s=typeof s=="function"?s():s,s=s===null||s===void 0?"":s,n[n.length]=a(l)+"="+a(s)},i=(l,s)=>{let d,g,y;if(l)if(Array.isArray(s))for(d=0,g=s.length;d<g;d++)i(l+"["+(typeof s[d]===b&&s[d]?d:"")+"]",s[d]);else if(typeof s===b&&s!==null)for(y in s)i(l+"["+y+"]",s[y]);else o(l,s);else if(Array.isArray(s))for(d=0,g=s.length;d<g;d++)o(s[d].name,s[d].value);else for(y in s)i(y,s[y]);return n},m=i("",t).join("&").replace(/%5B%5D/g,"[]");return pe(e,m)}function Re(e,t){return t?e.replace(/:\w+/g,n=>{let a=n.substring(1);return String(t[a]?t[a]:n)}):e}function me(e){let t=typeof e;if(t===x||e===null)return!1;if(t===j||t==="number"||t==="boolean"||Array.isArray(e))return!0;if(Buffer.isBuffer(e)||e instanceof Date)return!1;if(t===b){let n=Object.getPrototypeOf(e);if(n===Object.prototype||n===null||typeof e.toJSON=="function")return!0}return!1}async function ne(e){return new Promise(t=>setTimeout(()=>t(!0),e))}function re(e){return e&&typeof e===b&&typeof e.data!==x&&Object.keys(e).length===1?re(e.data):e}function he(e){if(!e)return{};let t={};if(e instanceof Headers)e.forEach((n,a)=>{t[a]=n});else if(typeof e===b&&e!==null)for(let[n,a]of Object.entries(e))t[n.toLowerCase()]=a;return t}function F(e,t){e&&t in e&&delete e[t]}var k=new Map;async function ge(e,t,n=0,a=!1,o=!0){let i=Date.now(),h=k.get(e);if(h){let s=h[3],d=h[0],g=h[1];if(!s&&i-h[2]<n)return d;s&&d.abort(new DOMException("Aborted due to new request",J)),g!==null&&clearTimeout(g),k.delete(e)}let m=new AbortController,l=o?setTimeout(()=>{let s=new DOMException(`${e.url} aborted due to timeout`,le);$(e,s)},t):null;return k.set(e,[m,l,i,a]),m}async function $(e,t=null){let n=k.get(e);if(n){let a=n[0],o=n[1];t&&!a.signal.aborted&&a.abort(t),o!==null&&clearTimeout(o),k.delete(e)}}async function Pe(e){var a;if(!(e!=null&&e.body))return null;let t=String(((a=e.headers)==null?void 0:a.get(L))||"").split(";")[0],n;try{if(t.includes(M)||t.includes("+json"))n=await e.json();else if(t.includes("multipart/form-data"))n=await e.formData();else if(t.includes("application/octet-stream"))n=await e.blob();else if(t.includes("application/x-www-form-urlencoded"))n=await e.formData();else if(t.includes("text/"))n=await e.text();else try{n=await e.clone().json()}catch(o){n=await e.text()}}catch(o){n=null}return n}function v(e){let t=0;for(let n=0,a=e.length;n<a;n++){let o=e.charCodeAt(n);t=t*31+o|0}return String(t)}var se=new Map;function Ee(e){let{url:t="",method:n=U,headers:a={},body:o="",mode:i="cors",credentials:h="include",cache:m="default",redirect:l="follow",referrer:s="",integrity:d=""}=e;if(m==="reload")return"";let g=de(te(a)),y="";if(o!==null)if(typeof o=="string")y=v(o);else if(o instanceof FormData)o.forEach((r,u)=>{y+=u+"="+r+"&"}),y=v(y);else if(typeof Blob!==x&&o instanceof Blob||typeof File!==x&&o instanceof File)y="BF"+o.size+o.type;else if(o instanceof ArrayBuffer||ArrayBuffer.isView(o))y="AB"+o.byteLength;else{let r=typeof o===b?te(o):String(o);y=v(JSON.stringify(r))}return n+t+i+h+m+l+s+d+g+y}function He(e,t){return t?Date.now()-e>t*1e3:!1}function Ce(e,t){let n=se.get(e);if(n){if(!He(n.timestamp,t))return n;se.delete(e)}return null}function Te(e,t,n=!1){se.set(e,{data:t,isLoading:n,timestamp:Date.now()})}var Se={method:U,strategy:"reject",timeout:3e4,dedupeTime:1e3,defaultResponse:null,headers:{Accept:M+", text/plain, */*","Accept-Encoding":"gzip, deflate, br",[L]:M+";charset=utf-8"},retry:{delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504]}};function G(e){let t=C(C({},Se),e),n=t.fetcher,a=(n==null?void 0:n.create(t))||null,o=()=>a,i=(r,u)=>typeof r[u]!==x?r[u]:t[u],h=(...r)=>{var u;(u=t.logger)!=null&&u.warn&&t.logger.warn(...r)},m=(r,u,f)=>{let R=i(f,"method").toUpperCase(),P=R===U||R===fe,c=Re(r,i(f,"urlPathParams")),E=i(f,"params"),q=i(f,"body")||i(f,"data"),z=!!(u&&(P||q)),T;P||(T=q||u);let Q=i(f,"withCredentials")?"include":i(f,"credentials");F(f,"data"),F(f,"withCredentials");let D=E||z?ye(c,E||u):c,w=D.includes("://")?"":i(f,"baseURL")||i(f,"apiUrl");return T&&typeof T!==j&&!ee(T)&&me(T)&&(T=JSON.stringify(T)),B(C({},f),{credentials:Q,body:T,method:R,url:w+D})},l=async(r,u)=>{d(r)||h("API ERROR",r),await O(r,u==null?void 0:u.onError),await O(r,t==null?void 0:t.onError)},s=async(r,u,f)=>{let R=d(r),P=i(f,"strategy"),c=i(f,"rejectCancelled");if(!(R&&!c)){if(P==="silent")await new Promise(()=>null);else if(P==="reject")return Promise.reject(r)}return y(u,f,r)},d=r=>r.name===J||r.name===ue,g=async(r,u=null,f=null)=>{var ae;let R=f||{},P=C(C({},t),R),c=null,E=m(r,u,P),{timeout:q,cancellable:z,dedupeTime:T,pollingInterval:K,shouldStopPolling:Q,cacheTime:D,cacheKey:Y}=P,w;if(Y?w=Y(E):w=Ee(E),D&&w){let I=P.cacheBuster;if(!I||!I(E)){let p=Ce(w,D);if(p)return p.data}}let{retries:W=0,delay:be,backoff:we,retryOn:V,shouldRetry:oe,maxDelay:xe,resetTimeout:Oe}=P.retry,H=0,X=0,N=be;for(;H<=W;)try{let I=await ge(E,q,T,z,!!(q&&(!W||Oe))),p=C({signal:I.signal},E);if(await O(p,R==null?void 0:R.onRequest),await O(p,t==null?void 0:t.onRequest),n!==null&&a!==null?c=await a.request(p):c=await fetch(p.url,p),c instanceof Response&&(c.config=p,c.data=await Pe(c),!c.ok))throw new _(`${p.url} failed! Status: ${c.status||null}`,p,c);if(await O(c,R==null?void 0:R.onResponse),await O(c,t==null?void 0:t.onResponse),$(E),K&&(!Q||!Q(c,X))){X++,h(`Polling attempt ${X}...`),await ne(K);continue}let S=y(c,p);if(D&&w){let ie=p.skipCache;(!ie||!ie(S,p))&&Te(w,S)}return S}catch(I){let p=I,S=((ae=p==null?void 0:p.response)==null?void 0:ae.status)||(p==null?void 0:p.status)||0;if(H===W||!(!oe||await oe(p,H))||!(V!=null&&V.includes(S)))return await l(p,E),$(E),s(p,c,E);h(`Attempt ${H+1} failed. Retry in ${N}ms.`),await ne(N),N*=we,N=Math.min(N,xe),H++}return y(c,E)},y=(r,u,f=null)=>{let R=i(u,"defaultResponse"),P=i(u,"flattenResponse");if(!r)return P?R:{error:f,headers:null,data:R,config:u};F(f,"response"),F(f,"request"),F(f,"config");let c=r==null?void 0:r.data;return(c==null||typeof c===b&&Object.keys(c).length===0)&&(c=R),P?re(c):r instanceof Response?{body:r.body,bodyUsed:r.bodyUsed,formData:r.formData,ok:r.ok,redirected:r.redirected,type:r.type,url:r.url,status:r.status,statusText:r.statusText,blob:r.blob.bind(r),json:r.json.bind(r),text:r.text.bind(r),clone:r.clone.bind(r),arrayBuffer:r.arrayBuffer.bind(r),error:f,data:c,headers:he(r.headers),config:u}:r};return{getInstance:o,buildConfig:m,config:e,request:g}}function ft(e){let t=e.endpoints,n=G(e);function a(){return n.getInstance()}function o(l){return console.error(`Add ${l} to 'endpoints'.`),Promise.resolve(null)}async function i(l,s={},d={},g={}){let y=t[l];return await n.request(y.url,s,B(C(C({},y||{}),g),{urlPathParams:d}))}function h(l){return l in m?m[l]:t[l]?m.request.bind(null,l):o.bind(null,l)}let m={config:e,endpoints:t,requestHandler:n,getInstance:a,request:i};return new Proxy(m,{get:(l,s)=>h(s)})}async function Ne(e,t={}){return G(t).request(e,null,t)}export{ft as createApiFetcher,Ne as fetchf};
//# sourceMappingURL=index.mjs.map