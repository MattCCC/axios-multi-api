(()=>{async function D(n,e){if(!e)return n;let s=Array.isArray(e)?e:[e],t={...n};for(let r of s)t=await r(t);return t}async function I(n,e){if(!e)return n;let s=Array.isArray(e)?e:[e],t=n;for(let r of s)t=await r(t);return t}var P=class extends Error{response;request;config;status;statusText;constructor(e,s,t){super(e),this.name="ResponseError",this.message=e,this.status=t.status,this.statusText=t.statusText,this.request=s,this.config=s,this.response=t}};function H(n,e){if(!e)return n;if(e instanceof URLSearchParams){let i=e.toString();return n.includes("?")?`${n}&${i}`:i?`${n}?${i}`:n}let s=[],t=function(i,o){o=typeof o=="function"?o():o,o=o===null||o===void 0?"":o,s[s.length]=encodeURIComponent(i)+"="+encodeURIComponent(o)},r=(i,o)=>{let u,c,d;if(i)if(Array.isArray(o))for(u=0,c=o.length;u<c;u++)r(i+"["+(typeof o[u]=="object"&&o[u]?u:"")+"]",o[u]);else if(typeof o=="object"&&o!==null)for(d in o)r(i+"["+d+"]",o[d]);else t(i,o);else if(Array.isArray(o))for(u=0,c=o.length;u<c;u++)t(o[u].name,o[u].value);else for(d in o)r(d,o[d]);return s},a=r("",e).join("&").replace(/%5B%5D/g,"[]");return n.includes("?")?`${n}&${a}`:a?`${n}?${a}`:n}function U(n,e){return e?n.replace(/:[a-zA-Z]+/gi,s=>{let t=s.substring(1);return String(e[t]?e[t]:s)}):n}function O(n){if(n==null)return!1;let e=typeof n;if(e==="string"||e==="number"||e==="boolean")return!0;if(e!=="object")return!1;if(Array.isArray(n))return!0;if(Buffer.isBuffer(n)||n instanceof Date)return!1;let s=Object.getPrototypeOf(n);return s===Object.prototype||s===null||typeof n.toJSON=="function"}async function S(n){return new Promise(e=>setTimeout(()=>e(!0),n))}var w=new WeakMap,C=new WeakMap;async function j(n,e){let s,t=new Promise(r=>s=r);C.has(n)&&await C.get(n),C.set(n,t);try{return await e()}finally{s(),C.delete(n)}}async function Q(n,e,s=0,t=!1,r=!1){return j(n,async()=>{let l=Date.now(),a=w.get(n);if(a){if(l-a.timestamp<s)return a.controller;t&&a.controller.abort(),q(n)}let i=new AbortController,o=e>0&&!r?setTimeout(()=>{let u=new Error(`${n.url} aborted due to timeout`);u.name="TimeoutError",u.code=23,i.abort(u),q(n)},e):null;return w.set(n,{controller:i,timeoutId:o,timestamp:l}),i})}async function q(n){await j(n,async()=>{let e=w.get(n);e&&(e.timeoutId!==null&&clearTimeout(e.timeoutId),w.delete(n))})}var A="application/json",m=class{requestInstance;baseURL="";timeout=3e4;strategy="reject";method="get";flattenResponse=!1;defaultResponse=null;fetcher;logger;retry={retries:0,delay:1e3,maxDelay:3e4,resetTimeout:!0,backoff:1.5,retryOn:[408,409,425,429,500,502,503,504],shouldRetry:async()=>!0};config={};constructor({fetcher:e=null,timeout:s=null,strategy:t=null,flattenResponse:r=null,defaultResponse:l={},logger:a=null,...i}){this.fetcher=e,this.timeout=s??this.timeout,this.strategy=t||this.strategy,this.flattenResponse=r||this.flattenResponse,this.defaultResponse=l,this.logger=a||null,this.baseURL=i.baseURL||i.apiUrl||"",this.method=i.method||this.method,this.config={rejectCancelled:!1,dedupeTime:1e3,...i},this.retry={...this.retry,...i.retry||{}},this.requestInstance=this.isCustomFetcher()?e.create({...i,baseURL:this.baseURL,timeout:this.timeout}):null}getInstance(){return this.requestInstance}buildConfig(e,s,t){let r=(t.method||this.method).toUpperCase(),l=r==="GET"||r==="HEAD",a=U(e,t.urlPathParams||this.config.urlPathParams),i=t.params||this.config.params,o=t.body||t.data||this.config.body||this.config.data,u=!!(s&&(l||o)),c;if(l||(c=o||s),this.isCustomFetcher())return{...t,method:r,url:a,params:u?s:i,data:c};let d=t.withCredentials||this.config.withCredentials?"include":t.credentials;delete t.data,delete t.withCredentials;let R=i||u?H(a,i||s):a,b=R.includes("://")?"":t.baseURL||this.baseURL;return c&&typeof c!="string"&&!(c instanceof URLSearchParams)&&O(c)&&(c=JSON.stringify(c)),{...t,credentials:d,body:c,method:r,url:b+R,headers:{Accept:A+", text/plain, */*","Content-Type":A+";charset=utf-8",...t.headers||this.config.headers||{}}}}processError(e,s){var t;this.isRequestCancelled(e)||((t=this.logger)!=null&&t.warn&&this.logger.warn("API ERROR",e),s.onError&&s.onError(e),this.config.onError&&this.config.onError(e))}async outputErrorResponse(e,s,t){let r=this.isRequestCancelled(e),l=t.strategy||this.strategy,a=typeof t.rejectCancelled<"u"?t.rejectCancelled:this.config.rejectCancelled;if(!(r&&!a)){if(l==="silent")await new Promise(()=>null);else if(l==="reject")return Promise.reject(e)}return this.outputResponse(s,t,e)}isRequestCancelled(e){return e.name==="AbortError"||e.name==="CanceledError"}isCustomFetcher(){return this.fetcher!==null}async request(e,s=null,t=null){var F,x,E,T;let r=null,l=t||{},a=this.buildConfig(e,s,l),i=typeof a.timeout<"u"?a.timeout:this.timeout,o=typeof a.cancellable<"u"?a.cancellable:this.config.cancellable,u=typeof a.dedupeTime<"u"?a.dedupeTime:this.config.dedupeTime,{retries:c,delay:d,backoff:R,retryOn:h,shouldRetry:b,maxDelay:L,resetTimeout:k}={...this.retry,...(a==null?void 0:a.retry)||{}},y=0,g=d;for(;y<=c;)try{let p={signal:(await Q(a,i,u,o,k)).signal,...a};if(p=await D(p,p==null?void 0:p.onRequest),p=await D(p,(F=this.config)==null?void 0:F.onRequest),this.isCustomFetcher())r=await this.requestInstance.request(p);else if(r=await globalThis.fetch(p.url,p),r.config=p,r.data=await this.parseData(r),!r.ok)throw new P(`${p.url} failed! Status: ${r.status||null}`,p,r);return r=await I(r,p==null?void 0:p.onResponse),r=await I(r,(x=this.config)==null?void 0:x.onResponse),this.outputResponse(r,p)}catch(f){if(y===c||!await b(f,y)||!(h!=null&&h.includes(((E=f==null?void 0:f.response)==null?void 0:E.status)||(f==null?void 0:f.status))))return this.processError(f,a),q(a),this.outputErrorResponse(f,r,a);(T=this.logger)!=null&&T.warn&&this.logger.warn(`Attempt ${y+1} failed. Retrying in ${g}ms...`),await S(g),g*=R,g=Math.min(g,L),y++}return this.outputResponse(r,a)}async parseData(e){var r;if(!(e!=null&&e.body))return null;let s=String(((r=e.headers)==null?void 0:r.get("Content-Type"))||"").split(";")[0],t;try{if(s.includes(A)||s.includes("+json"))t=await e.json();else if(s.includes("multipart/form-data"))t=await e.formData();else if(s.includes("application/octet-stream"))t=await e.blob();else if(s.includes("application/x-www-form-urlencoded"))t=await e.formData();else if(s.includes("text/"))t=await e.text();else try{t=await e.clone().json()}catch{t=await e.text()}}catch{t=null}return t}processHeaders(e){let s=e.headers;if(!s)return{};let t={};if(s instanceof Headers)s.forEach((r,l)=>{t[l]=r});else if(typeof s=="object"&&s!==null)for(let[r,l]of Object.entries(s))t[r.toLowerCase()]=l;return t}flattenData(e){return e&&typeof e=="object"&&typeof e.data<"u"&&Object.keys(e).length===1?this.flattenData(e.data):e}outputResponse(e,s,t=null){let r=typeof s.defaultResponse<"u"?s.defaultResponse:this.defaultResponse,l=typeof s.flattenResponse<"u"?s.flattenResponse:this.flattenResponse;if(!e)return l?r:{error:t,headers:null,data:r,config:s};t!==null&&(t==null||delete t.response,t==null||delete t.request,t==null||delete t.config);let a=e==null?void 0:e.data;return(a==null||typeof a=="object"&&Object.keys(a).length===0)&&(a=r),l?this.flattenData(a):this.isCustomFetcher()?e:{body:e.body,blob:e.blob,json:e.json,text:e.text,clone:e.clone,bodyUsed:e.bodyUsed,arrayBuffer:e.arrayBuffer,formData:e.formData,ok:e.ok,redirected:e.redirected,type:e.type,url:e.url,status:e.status,statusText:e.statusText,error:t,data:a,headers:this.processHeaders(e),config:s}}};function Y(n){let e=n.endpoints,s=new m(n);function t(){return s.getInstance()}function r(o){return console.error(`${o} endpoint must be added to 'endpoints'.`),Promise.resolve(null)}async function l(o,u={},c={},d={}){let h={...e[o]};return await s.request(h.url,u,{...h,...d,urlPathParams:c})}function a(o){return o in i?i[o]:e[o]?i.request.bind(null,o):r.bind(null,o)}let i={config:n,endpoints:e,requestHandler:s,getInstance:t,request:l};return new Proxy(i,{get:(o,u)=>a(u)})}async function te(n,e={}){return new m(e).request(n,null,e)}})();
//# sourceMappingURL=index.global.js.map